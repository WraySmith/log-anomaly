# Process Folder

Contains code to extract features from the semi-structured log files produced by the files contained within the `parse` directory. The data generated in this folder is used directly by the CNN model.

## Feature Extraction Overview

The code in this directory borrows heavily from the feature extraction functionality of the [Loglizer](https://github.com/logpai/loglizer) project. 

+ Shilin He, Jieming Zhu, Pinjia He, Michael R. Lyu. [Experience Report: System Log Analysis for Anomaly Detection](https://jiemingzhu.github.io/pub/slhe_issre2016.pdf), *IEEE International Symposium on Software Reliability Engineering (ISSRE)*, 2016.


Loglizer takes semi-structured log files and turns them into a dataframe, with one column as the block ids and another column the block's events stored as a list. Then turns the event lists into a bag of words, with options for normalization and TF-IDF, to be fed into a predictive model.

This repository uses the framework of Loglizer's feature extraction but adds the following functionality:

- Applies a sliding window to the event sequences to create "time-images"
- TF-IDF is then performed on the 2D time-image arrays
- The output is an array of 2D arrays for each block.

## Data and Scripts

The following provides a description of the files located in this folder:

- `sliding_window_processor.py` contains the functions used to generate the block event features as described above.

- `project_processor.py` uses the functions in `sliding_window_processor.py` to extract features from the data generated by `/parse/project_parser.py` and located in the `/parse/project_parsed` folder. Specifically, the files called by `project_processor.py` are:
    - `anomaly_label.csv` (anomalous/normal labels for HDFS blocks)
    - `HDFS_train.log_structured.csv` (training data)
    - `HDFS_test.log_structured.csv` (testing data)
- The processed data is then stored in the `project_processed_data` folder as:
    - `x_train_{version_and_details}.npy`
    - `x_test_{version_and_details}.npy`
    - `y_train_{version_and_details}.csv`
    - `y_test_{version_and_details}.csv`
- `process_demo.ipynb` provides a demo of using the processing script and is likely the best way to understand the feature extraction code at a high-level.

- `test_sliding_window_processor.py` provides a small number of tests for `sliding_window_processor.py`
